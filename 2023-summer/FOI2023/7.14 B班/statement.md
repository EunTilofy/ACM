# Day 6 练习题（“简单”数学）

<center></br></br>By PaperCloud</br></br>
    （请选手仔细阅读此页内容）</br></br>
比赛时间：2023-7-13</br></br>
</center>

| 试题名称   | 数上LCA  | 加三十三 | 未命名一 | 虚空之梦 |
| ---------- | -------- | -------- | -------- | -------- |
| 时间限制   | 1000ms   | 1000ms   | 1000ms   | 1000ms   |
| 内存上限   | 512MB    | 512MB    | 512MB    | 512MB    |
| 评测方式   | 全文比较 | 全文比较 | 全文比较 | 全文比较 |
| 测试点数目 | 20       | 10       | 10       | 打包测试 |

</br></br>

⚠️ **注意事项：**

1. 难度严格递增；

2. 尽可能把可以拿到的部分分都拿到；

3. 有问题找出题人；

5. 推荐一种快速的输入输出方法，以（A+B problem 为例）：

   ```c++
   #include<bits/stdc++.h>
   using namespace std;
   int main() {
       ios::sync_with_stdio(0);cin.tie(0);
       int a, b;
       cin >> a >> b;
       cout << a + b << "\n";
       // 使用 “\n" 比 std::endl 更快。
       // 关同步后，cin/cout 和 scanf/printf 不要混用。
   }
   
   ```


<div STYLE="page-break-after: always;"></div>

## 数上 LCA

### 题目描述

> Barisore 喜欢研究树，也喜欢研究数。

我们知道，一个树上节点的父亲是它的祖先中深度最大的。 Barisore 认为，一个正整数的“父亲”，是它所有约数中最大的那个，比如 $6$ 的父亲是 $3$，$100$ 
 的父亲是 $50$。

Barisore 痴迷于 LCA（树上最近公共祖先）问题，于是她向你提出了 $q$ 个问题，每个问题给了你两个正整数 $x$ 和 $y$，她想知道它们的“LCA”是多少。

### 输入格式

第一行一个正整数 $q$，表示询问个数。

接下来 $q$ 行，每行两个正整数 $x$ 和 $y$，表示一个询问。

### 输出格式

输出 $q$ 行，对于每个询问输出一个数表示答案。

### 样例输入与输出

#### 输入样例

```plaintext
2
100 50
18 12
```

#### 输出样例
```plaintext
50
3
```

#### 样例解释
$100$ 的父亲是 $50$；
$18$ 的父亲是 $9$，$12$ 的父亲是 $6$，$9$ 和 $6$ 的父亲都是 $3$。

### 数据范围与提示

设 $N$ 为所有输入 $x,y$ 的最大值。

对于 40% 的数据，$N,q\le 5000$;

对于 70% 的数据，$N,q \le 10^6$;

对于 100% 的数据，$N \le 10^7, q \le 10^6$。

由于输出输出量过大，请不要使用过慢的输入输出方式（如未关同步的 cin/cout）。

**提示：**

1. 如何求一个数的最大约数？思考课上讲过的线性筛法的过程。

2. 一个数作质因数分解，最多 $O(\log n)$ 次，使用朴素的求 LCA 算法就可以啦。

下面附上线性筛的代码：

```c++
const int N=1e7+3;
bool np[N];
int pri[N/10],cnt;
void init(int n){
    for(int i=2;i<=n;++i){
        if(!np[i])pri[++cnt]=i;
	    for(int j=1;j<=cnt&&i*pri[j]<=n;++j){
	        np[i*pri[j]]=1;
	        if(!(i%pri[j]))break;
	    }
    }
}
```

<div STYLE="page-break-after: always;"></div>

## 加三十三

### 题目描述

万众期待的 Z 大篮球赛即将开幕。

三十三班为了展现班级风采，Barisore 被任命在 $n$ 个报名的同学中选 $m$ 名参赛队员去参加比赛。

这 $n$ 名同学各有擅长，其中 $a$ 名同学只擅长前场，$b$ 名同学只擅长后场，更有 $c$ 名全能选手（既擅长前场又擅长后场）。当然，也有一些重在参与的同学，他们二者都不擅长。

Barisore 决定让 $x$ 名擅长前场的同学担任前锋，$y$ 名同学擅长后卫的同学担任后卫首发出场，剩下 $m-x-y$ 名同学作为替补队员。Barisore 对替补队员没有要求。

她想知道有多少种不同的选择方案。两种方案不同当且仅当有任意一名同学的出场情况（前锋/后卫/替补/未选上）不同。由于这个方案数可能很大，你只需要输出其对 $998244353$ 取模的值即可。

### 输入格式

一行 $7$ 个整数 $n,m,a,b,c,x,y$。

### 输出格式

一行一个整数，方案数对 $998244353$ 取模的值。

### 样例输入与输出

#### 样例输入1

```plain
12 7 4 3 2 3 2
```

#### 样例输出1

```plain
2604
```

#### 样例输入2

```plain
5000 3000 1500 800 400 200 100
```

#### 样例输出2

```plain
541028747
```

### 数据范围与提示

对于全部数据，$0\leq n,m,a,b,c,x,y\leq 10^7,m\leq n,a+b+c\leq n,x+y\leq m$。

子任务：

| 测试点编号 | $n,m\leq$ | 特殊限制 |
| ---------- | --------- | -------- |
| $1$        | $10$      |          |
| $2$        | $1000$    | $n=m$    |
| $3$        | $1000$    | $c=0$    |
| $4$        | $1000$    |          |
| $5$        | $10^7$    | $n=m$    |
| $6$        | $10^7$    | $c=0$    |
| $7$        | $10^7$    | $x+y=m$  |
| $8$        | $10^7$    |          |
| $9$        | $10^7$    |          |
| $10$       | $10^7$    |          |

**提示：**

1. 可以先枚举 $a$ 名擅长前场的同学中有多少个被选中。

2. 阶乘，阶乘逆元预处理：

```c++
const int N=1e7+10,mod=998244353;
inline int inc(int x,int y){return x+y>=mod?x+y-mod:x+y;} // 加法
inline int dec(int x,int y){return x-y<0?x-y+mod:x-y;} // 减法
inline int mul(int x,int y){return (ll)x*y%mod;} // 乘法
inline int qpow(int x,int y){ // 快速幂运算
	int r=1;
	for(;y;y>>=1){
		if(y&1)r=mul(r,x);
		x=mul(x,x);
	}return r;
}
inline int inv(int x){return qpow(x,mod-2);} // 逆元运算
int fac[N],inf[N];
void init(int n){ // 预处理部分
	fac[0]=1;
	for(int i=1;i<=n;++i)fac[i]=mul(fac[i-1],i);
	inf[n]=inv(fac[n]);
	for(int i=n-1;~i;--i)inf[i]=mul(inf[i+1],i+1);
}
```

<div STYLE="page-break-after: always;"></div>

## 未命名一

### 题目描述

> Barisore 与数学/OI的邂逅，是 dev-c++ 里新建的第一个 未命名1.cpp 开始的。

今天，Barisore 给你出了一道题：

从 $1,2,\dots,n$ 中选出一些数使得选出的任意两个数之积都不是立方数，问最多能选出多少个。

她刚出完就认为这个问题过于简单，因此又追加了一个问题：

设上面这个问题的答案是 $f(n)$，求 $\oplus_{i=1}^n if(i)$ 的值。

### 输入格式

一个数，$n$。

### 输出格式

一个数，答案。

### 样例输入与输出

#### 样例输入1

```plain
10
```

#### 样例输出1

```plain
96
```

#### 样例输入2
```plain
114
```

#### 样例输出2
```plain
8840
```

#### 样例输入3
```plain
1919810
```

#### 样例输出3
```plain
39665825343
```

### 数据范围与提示

对于前 $3$ 组数据，$n\leq 50$。

对于第 $4$ 至 $8$ 组数据，对于第 $k$ 组数据，$n\leq 10^{k-2}$。

对于全部数据，$1\leq n\leq 10^7$。

### 样例解释

$n=1$ 时，选择 $\{1\}$

$n=2$ 时，选择 $\{1,2\}$

$n=3$ 时，选择 $\{1,2,3\}$

$n=4$ 时，选择 $\{1,2,3\}$

$n=5$ 时，选择 $\{1,2,3,5\}$

$n=6$ 时，选择 $\{1,2,3,5,6\}$

$n=7$ 时，选择 $\{1,2,3,5,6,7\}$

$n=8$ 时，选择 $\{1,2,3,5,6,7\}$

$n=9$ 时，选择 $\{1,2,3,5,6,7\}$

$n=10$ 时，选择 $\{1,2,3,5,6,7,10\}$

因此，$f(1)$ 到 $f(10)$ 分别为 $1,2,3,3,4,5,6,6,6,7$。

**提示：**

1. $n\le 50$，可以使用打表方法。

2. 考虑取数的规律：

    记

   $$
       \begin{aligned}
   \left[x \right] &=\{k^3x|k\in \mathbb{N}^*,1\leq k^3x\leq n\} \\
   \overline{x}&=\min\{y\in\mathbb{N}^*|xy=k^3,k\in\mathbb{N}^*\}
   \end{aligned}
   $$

   其中规定 $x$ 无立方因子（即不能被 $1$ 以外任何立方数整除）。\pause

   容易发现：

   1. $[1]$ 中只能选择一个数。

   2. 若 $x\neq 1$，$[x]$ 要么不选，要么全选。

   3. $[x]$ 和 $[\overline{x}]$ 只能二选一。

3. 预处理出 $[x]$ 和 $\overline{x}$，并维护所有 $[x]$ 当前的大小，贪心选择 $[x]$ 和 $[\overline{x}]$ 中较大者即可。这样你就可以拿到 60 分；
4. 尝试更快地计算 $\overline{x}$，你可以获得更高的分数。比如：质因数分解。
5. 记 $f(x) = \overline{x}$，$f(x)$ 是一个积性函数，试着用线性筛来计算它。

<div STYLE="page-break-after: always;"></div>



## 虚空之梦

### 题目描述

> $2023$ 年 $6$ 月 $30$ 日 $5:30$，天亮了，而通宵复习期末考的 Barisore 还没放下手中的笔记。
>
> 最后，她带着迷茫和困倦，进入了梦乡。
>
> 梦境里，她再次来到那间充斥着数学的味道的教室，而此时这里空无一人，摆的整整齐齐的 $n\times m$ 张桌子，每一张桌子上都留着他曾经努力听课的痕迹。
>
> 那些模糊的记忆都化成了数字出现在她眼前。

有一个 $n$ 行 $m$ 列的矩阵，第 $i$ 行第 $j$ 列为整数 $a_{i,j}$。

定义一个子矩阵 $[a,b]\times [c,d]$ 的回忆值为其中所有数之和的 $k$ 次方， $(\sum_{i=a}^b\sum_{j=c}^da_{i,j})^k$，其中 $k$ 是给定的常数。

注：在本题中，我们规定 $0^0=1$。

请计算这个矩阵的所有子矩阵的回忆值之和。

形式化的，请你计算 $\sum_{a=1}^n\sum_{b=a}^n\sum_{c=1}^m\sum_{d=c}^m (\sum_{i=a}^b\sum_{j=c}^da_{i,j})^k$。

### 输入格式

第一行三个整数 $n,m,k$。

以下 $n$ 行每行 $m$ 个整数 $a_{i,j}$。

### 输出格式

一行一个整数表示答案。由于这个数可能过大，你只需输出其对 $2^{32}$ 取模的值即可。

### 样例与输出与输出

#### 样例输入1

```plain
2 3 1
2 8 7
4 5 9
```

#### 样例输出1

```plain
236
```

#### 样例输入2

```plain
5 7 3
3 4 7 6 9 4 5
5 4 2 9 7 8 4
3 1 9 4 5 2 2
3 8 9 5 6 6 3
5 1 9 4 8 2 6
```

#### 样例输出2

```plain
90937097
```

### 数据范围与提示

对于全部数据，$1\leq n\times m\leq 2\times 10^5,0\leq k\leq 10,0\leq a_{i,j}<2^{32}$。

子任务 1（$6$ 分）：$1\leq n,m\leq 20$；

子任务 2（$8$ 分）：$1\leq n,m\leq 100$；

子任务 3（$6$ 分）：$k=0$；

子任务 4（$16$ 分）：$n=1$；

子任务 5（$24$ 分）：$k\leq 3$；

子任务 6（$40$ 分）：无特殊限制。

子任务内部有一定梯度。

**提示：**

1. 使用二维前缀和可以获得 14 分；

2. $k=0$ 时，答案只和矩阵的大小有关；

3. $n=1$ 时，矩阵退化成数组，矩阵和变成了区间和，我们试着用前缀和来计算这个答案：

   $$
   \begin{aligned}
   &\sum_{i=0}^{n}\sum_{j=i}^n(s_j-s_i)^K\\
   =&\sum_{i=0}^{n}\sum_{j=i}^n\sum_{k=0}^K(-1)^k\dbinom Kks_j^ks_i^{K-k}\\
   =&\sum_{k=0}^K(-1)^k\dbinom Kk\sum_{i=0}^ns_i^{K-k}\sum_{j=i}^ns_j^k
       \end{aligned}
   $$

4. 注意到 $nm\leq 2\times 10^5$，因此 $\min\{n,m\}\leq 450$。